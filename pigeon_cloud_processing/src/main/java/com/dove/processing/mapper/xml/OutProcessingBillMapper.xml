<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dove.processing.mapper.OutProcessingBillMapper">

<sql id="selectAllBill">
    select id,out_id,handler,consignee,name,total_amount,total,remark,out_time
    from t_out_processing_bill
    where is_deleted =0
</sql>

    <select id="getBillByPage" resultType="com.dove.processing.entity.Vo.OutProcessingBillVo">
        <include refid="selectAllBill"/>
        order by gmt_create desc
        <if test="no !=null and size != null">
            limit ${no},${size}
        </if>
    </select>

    <select id="getBusInfoByBossId" resultType="com.dove.processing.entity.Vo.BusinessProcessingVo">
    select t.id,t.name,t.phone,t.contacts,t.type
    from t_business_processing t
    <if test="consignee != null and consignee != 0">
        inner join t_out_processing_bill p
        on t.id = p.consignee
        where p.consignee = ${consignee} and p.is_deleted = 0
    </if>
    order by gmt_create desc
    limit ${no},${size}
    </select>

    <select id="getBillsByLikeSearch" resultType="com.dove.processing.entity.Vo.OutProcessingBillVo">
        <include refid="selectAllBill"/>
        <if test="value != null and value!='' and value!='null'">
            and concat(handler,name) like '%${value}%'
        </if>
        order by gmt_create desc
        limit ${no},${size}
    </select>

    <select id="getBillsByNoPage" resultType="com.dove.processing.entity.Vo.BillBindInfoVo">
        select p.type_id,p.processing_type,p.amount,p.unit_price,p.price,
        t.handler,t.name,t.total_amount,t.total,t.remark,t.out_time
        from t_out_processing as p ,t_out_processing_bill as t
        where p.out_id = t.out_id
        and p.is_deleted =0 and t.is_deleted
        order by gmt_create desc
    </select>
</mapper>
