<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dove.processing.mapper.ProcessingFlowMapper">

    <sql id="selectAllFlow">
        select process_id,processing_id,process_name,process_describe
        from t_processing_flow
    </sql>

    <select id="getFlowInfoByPage" resultType="com.dove.processing.entity.Vo.ProcessingFlowVo">
        <include refid="selectAllFlow"/>
        where is_deleted =0
        <if test="no !=null and size != null">
            order by gmt_create desc
            limit ${no},${size}
        </if>
    </select>

    <select id="getMoreFlowInfo" resultType="com.dove.processing.entity.Vo.ProcessingFlowBindBatchBillVo">
        select t.process_id,t.processing_id,t.process_name,t.process_describe,p.process_principal,p.process_time
        from t_processing_flow as t
        <if test="id != null and id!= '' and id != 0">
            inner join t_processing_batch_bill as p
            on t.process_id = p.process_id
            where p.process_id = #{id}
            and t.is_deleted =0 and p.is_deleted =0
        </if>
        <if test="no != null and size != null">
            order by t.gmt_create desc
            limit ${no},${size}
        </if>
    </select>

    <select id="getFlowInfoByLikeSearch" resultType="com.dove.processing.entity.Vo.ProcessingFlowVo">
        <include refid="selectAllFlow"/>
        <if test="value != null and value!='' and value!='null'">
            where is_deleted =0
            and process_name like '%${value}%'
        </if>
        order by gmt_create desc
        limit ${no},${size}
    </select>

    <select id="getTechnologyInfoByFlowId" resultType="com.dove.processing.entity.Vo.ProcessingTechnologyVo">
         select t.technology_id,t.technology_name,t.technology_describe,t.process_id
         from t_processing_technology as t
         <if test="id != null and id !=''">
             where #{id} in (select p.process_id from t_processing_flow p where p.is_deleted =0)
             and t.is_deleted =0
         </if>
        order by t.gmt_create desc
        limit ${no},${size}
    </select>

</mapper>
