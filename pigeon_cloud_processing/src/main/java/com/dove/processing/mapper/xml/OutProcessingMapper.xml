<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dove.processing.mapper.OutProcessingMapper">
<sql id="selectAllProcessing">
    select t.out_id,t.processing_id,t.type_id,t.processing_type,t.amount,t.unit_price,t.price,t.remark,t.processing_type,
    p.id,p.handler,p.consignee,p.name,p.total_amount,p.total_remark,p.out_time
    from t_out_processing as t
</sql>

    <select id="getProcessingByPage" resultType="com.dove.processing.entity.Vo.OutProcessingBothBindVo">
        <include refid="selectAllProcessing"/>
        <if test="no !=null and size != null">
            inner join t_out_processing_bill as p
            on t.out_id = p.out_id
            where t.is_deleted =0 and p.is_deleted =0
            order by t.gmt_create desc
            limit ${no},${size}
        </if>
    </select>

    <select id="getFactoryInfoByBossId" resultType="com.dove.processing.entity.Vo.DoveProcessingVo">
        select processing_id,enterprise_id,name,principal_name,introduction,province,city,
        detailed_address,picture,video
        from t_dove_processing
        <if test="consignee != null and consignee != 0">
            inner join t_out_processing p
            on t.processing_id = p.processing_id
            where p.processing_id = ${consignee} and p.is_deleted = 0
        </if>
        order by t.gmt_create desc
        limit ${no},${size}
    </select>

    <select id="getProcessingByLikeSearch" resultType="com.dove.processing.entity.Vo.OutProcessingBothBindVo">
        <include refid="selectAllProcessing"/>
        <if test="value != null and value!='' and value!='null'">
            inner join t_out_processing_bill as p
            on t.out_id = p.out_id
            where t.is_deleted =0 and p.is_deleted =0
            and concat(t.processing_type,p.name) like '%${value}%'
        </if>
        order by t.gmt_create desc
        limit ${no},${size}
    </select>

    <select id="getProcessingById" resultType="com.dove.processing.entity.Vo.OutProcessingBothBindVo">
        <include refid="selectAllProcessing"/>
        <if test="id !=null and id != 0">
            inner join t_out_processing_bill as p
            on t.out_id = p.out_id
            where t.is_deleted =0 and p.is_deleted =0
            and t.out_id = #{id}
        </if>
    </select>

    <select id="getDataByDateStamp" resultType="com.dove.processing.entity.Vo.OutProcessingBothBindVo">
        <include refid="selectAllProcessing"/>
        <if test="firstTime != null and lastTime != null ">
            inner join t_out_processing_bill as p
            on t.out_id = p.out_id
            where t.gmt_create
            between '${firstTime}'
            and '${lastTime}'
            and t.is_deleted =0 and p.is_deleted =0
        </if>
        order by t.gmt_create desc
        limit ${no},${size}
    </select>
</mapper>
